# פרק 5: שקלול, אילוצים ונטרול

***

## פרולוג: הדילמה של ה-Quant - מסיגנל לפורטפוליו

דמיינו שפית-על. היא בילתה שבועות בחיפוש אחר המרכיבים הטובים והטעימים ביותר בעולם. יש לה מתכון מבריק, חזון נועז למנה חדשה. אבל עכשיו מגיע רגע האמת: עליה לשלב את המרכיבים הללו, בפרופורציות הנכונות, בתנאים הנכונים, כדי ליצור מוצר סופי מאוזן, הרמוני וטעים. קורטוב מלח יותר מדי, רגע אחד יותר מדי בתנור, והמנה כולה עלולה להיהרס. המרכיבים המבריקים ביותר חסרי ערך ללא ביצוע מופתי של ההרכבה הסופית.

המשקיע הכמותי הוא השפית-על הזו. בפרקים הקודמים, עשינו את העבודה הקשה של השגת המרכיבים שלנו - הסיגנלים. יש לנו רשימה של מניות שאנו מאמינים שעומדות להניב תשואות עודפות. אבל רשימת מניות אינה פורטפוליו, בדיוק כפי שערימת מרכיבים אינה ארוחה. תהליך הפיכת הסיגנלים הגולמיים שלנו לפורטפוליו חי, נושם וסחיר הוא התחום של **בניית פורטפוליו (portfolio construction)**. זהו עולם של פשרות, של אופטימיזציה, של ניווט במציאות המבולגנת והמורכבת של העולם האמיתי. פרק זה הוא המדריך שלנו לשלב הסופי והחיוני הזה, שלעתים קרובות זוכה להערכת חסר, בתהליך ההשקעה הכמותית.

## בעיית בניית הפורטפוליו: מסגרת פורמלית

בבסיסה, כל בניית פורטפוליו היא בעיית אופטימיזציה. יש לנו **פונקציית מטרה (objective function)** שאנו רוצים למקסם (למשל, תשואה צפויה), ויש לנו סט של **אילוצים (constraints)** שעלינו לעמוד בהם (למשל, מגבלות על סיכון, תחלופה וריכוזיות). האמנות והמדע של בניית פורטפוליו טמונים במפרט האינטליגנטי של פונקציית מטרה זו ושל אילוצים אלה.

אנו יכולים לחשוב על תהליך בניית הפורטפוליו כבעל שלושה מנופים עיקריים שאנו יכולים למשוך:
1.  **שקלול (Weighting):** זוהי ההחלטה הבסיסית ביותר. בהינתן רשימת המניות האטרקטיביות שלנו, כמה מכל מניה עלינו לקנות? האם עלינו לתת משקל רב יותר למניות עם הסיגנלים החזקים ביותר? האם עלינו לתת משקל רב יותר למניות הפחות מסוכנות? שיטת השקלול היא המניע העיקרי לאופיו של הפורטפוליו.
2.  **אילוצים (Constraints):** העולם האמיתי אינו ואקום נטול חיכוך. אנו עומדים בפני שורה של מגבלות בעולם האמיתי על הפורטפוליו שלנו. ייתכנו לנו מגבלות על החשיפה שלנו למניה בודדת או לסector. ייתכנו לנו מגבלות על כמות המסחר שאנו יכולים לבצע בתקופה נתונה. אילוצים אלה אינם רק מטרדים; הם חלק חיוני ממסגרת ניהול סיכונים חזקה.
3.  **נטרול (Neutralization):** לסיגנלים שלנו עשויות להיות תופעות לוואי לא מכוונות ולא רצויות. סיגנל value, למשל, עשוי להיות מוטה באופן טבעי כלפי סקטורי הפיננסים והתשתיות. אם לא נהיה זהירים, אנו עלולים למצוא את עצמנו עם פורטפוליו שמבצע הימור גדול ולא מכוון על שיעורי הריבית. נטרול הוא התהליך של הסרה כירורגית של חשיפות פקטורים לא רצויות אלה כדי ליצור הימור "טהור" על הסיגנל המיועד שלנו.

## שיטות שקלול: מפשוט למתוחכם

בואו נחקור את תפריט האפשרויות להחלטת בניית הפורטפוליו הבסיסית ביותר: שיטת השקלול.

### השיטות הנאיביות: פשוט אבל לא טיפשי

*   **שקלול שווה (Equal Weighting):** זוהי הגישה הפשוטה ביותר האפשרית. אם יש לנו 100 מניות בפורטפוליו שלנו, אנו נותנים לכל אחת משקל של 1%. לשיטה זו יש מספר יתרונות מפתיעים. היא חזקה, קלה ליישום, ומספקת רמה גבוהה של פיזור. יש לה גם הטיה קונטרריאנית מרומזת; על ידי שקלול שווה, אנו נותנים משקל רב יותר למניות קטנות יותר ופחות משקל למניות גדולות יותר, ולמעשה מהמרים נגד השקלול מבוסס-שווי-השוק של השוק.
*   **שקלול לפי ערך (Value Weighting) (שקלול לפי שווי שוק):** זוהי השיטה המשמשת את רוב המדדים הפסיביים, כמו ה-S&P 500. המניות משוקללות ביחס לשווי השוק שלהן. בעוד שזוהי שיטת השקלול ה"ברירת מחדל" עבור השוק בכללותו, בדרך כלל זה לא מה שאנו רוצים עבור אסטרטגיה אקטיבית. פורטפוליו משוקלל-שווי-שוק מבצע, בהגדרה, הימור גדול על המניות הגדולות והפופולריות ביותר.

### השיטות מבוססות-הסיגנל: לתת לסיגנל להוביל

*   **שקלול יחסי לסיגנל (Signal-Proportional Weighting):** גישה אינטואיטיבית יותר היא לשקלל מניות ביחס לעוצמת ציון הסיגנל שלהן. מניה עם ציון z של 3 מקבלת פי שלושה מהמשקל של מניה עם ציון z של 1. הבעיה בגישה זו היא הרגישות שלה לחריגים. מניה בודדת עם ציון z גדול מאוד יכולה להגיע לשלוט בפורטפוליו.
*   **שקלול Softmax:** דרך אלגנטית יותר ליישם שקלול מבוסס-סיגנל היא פונקציית ה-**softmax**. המשקל של מניה *i* ניתן על ידי:

    *w<sub>i</sub> = e<sup>τs<sub>i</sub></sup> / Σ<sub>j</sub>e<sup>τs<sub>j</sub></sup>*

    כאשר *s<sub>i</sub>* הוא ציון הסיגנל של מניה *i*, ו-*τ* (טאו) הוא פרמטר ריכוזיות. לפונקציית ה-softmax יש את התכונה הנוחה שכל המשקלים מסתכמים ל-1. הפרמטר *τ* מאפשר לנו לשלוט ב"קוצניות" של הפורטפוליו. *τ* נמוך מוביל לפורטפוליו מפוזר יותר, בדומה לשקלול שווה. *τ* גבוה מוביל לפורטפוליו מרוכז מאוד, שבו כמעט כל המשקל נמצא על המניה הבודדת עם הציון הגבוה ביותר.

### השיטות מבוססות-הסיכון: הצד השני של המטבע

במקום לשקלל לפי התשואות הצפויות שלנו (הסיגנל), אנו יכולים לשקלל לפי הערכת הסיכון שלנו.
*   **שקלול הפוך לתנודתיות (Inverse Volatility Weighting):** כאן, אנו נותנים משקל רב יותר למניות עם תנודתיות היסטורית נמוכה יותר. המשקל של מניה *i* הוא פרופורציונלי ל-*1/σ<sub>i</sub>*, כאשר *σ<sub>i</sub>* היא התנודתיות שלה. האינטואיציה היא שאנו לוקחים פוזיציה גדולה יותר במניות שאנו מאמינים שהן פחות מסוכנות.
*   **שוויון סיכון (Risk Parity):** גישה מתוחכמת יותר שהפכה פופולרית מאוד בהקצאת נכסים מוסדית. מטרת שוויון הסיכון אינה להשוות את ההון המוקצה לכל נכס, אלא להשוות את **תרומת הסיכון (risk contribution)** של כל נכס לסיכון הכולל של הפורטפוליו. לעתים קרובות זה אומר לקחת פוזיציות גדולות יותר בנכסים בסיכון נמוך יותר, כמו אג"ח, ופוזיציות קטנות יותר בנכסים בסיכון גבוה יותר, כמו מניות.

## מסגרת אופטימיזציית תוחלת-שונות: סוס העבודה של ה-Quant

הכלי החזק והגמיש ביותר בארגז הכלים של בונה הפורטפוליו הוא **אופטימיזציית תוחלת-שונות (mean-variance optimization - MVO)**, המסגרת זוכת פרס נובל שפותחה על ידי הארי מרקוביץ'.

**מהפכת מרקוביץ':**
MVO מספקת מסגרת מתמטית למציאת הפורטפוליו ה"אופטימלי" שממקסם את התשואה הצפויה עבור רמה נתונה של סיכון. קבוצת כל הפורטפוליו האופטימליים הללו יוצרת את **הגבול היעיל (efficient frontier)**. בעיית ה-MVO מנוסחת בדרך כלל כך:

**max μ<sup>T</sup>w - λw<sup>T</sup>Σw**

משוואה זו מבקשת למקסם פונקציית תועלת שהיא פשרה בין התשואה הצפויה של הפורטפוליו (*μ<sup>T</sup>w*) לבין השונות שלו (*w<sup>T</sup>Σw*). הפרמטר *λ* (למדא) הוא **פרמטר סלידת הסיכון (risk aversion parameter)**. הוא מייצג את הסובלנות האישית של המשקיע לסיכון. *λ* גבוה יותר פירושו שהמשקיע סולד יותר מסיכון ויבחר בפורטפוליו עם סיכון נמוך יותר ותשואה צפויה נמוכה יותר.

**עקב אכילס של MVO: התשומות:**
MVO הוא כלי רב עוצמה, אך יש לו חולשה קריטית: הוא רגיש ביותר לתשומות שלו. הפתגם הישן "זבל נכנס, זבל יוצא" חל במלוא עוזו על MVO. שתי התשומות המרכזיות הן:
1.  **תשואות צפויות (μ):** אלו הם ציוני הסיגנל שלנו. כפי שאנו יודעים, סיגנלים הם רועשים ובלתי יציבים. שינויים קטנים בציוני הסיגנל שלנו יכולים להוביל לתנודות גדולות ודרמטיות במשקלי הפורטפוליו של MVO.
2.  **מטריצת השונות המשותפת (Σ):** זוהי המטריצה של כל השונויות המשותפות הזוגיות בין הנכסים ביקום שלנו. זהו מנוע הערכת הסיכון במסגרת MVO. למרבה הצער, מטריצת השונות המשותפת ההיסטורית היא לעתים קרובות אומדן רועש ובלתי יציב של מטריצת השונות המשותפת האמיתית והעתידית. פורטפוליו שנראה אופטימלי בהתבסס על מטריצת השונות המשותפת ההיסטורית יכול להתברר כמסוכן באופן מפתיע בעולם האמיתי.

**הפתרון: לאלף את מטריצת השונות המשותפת עם Shrinkage:**
בהתחשב בבעיות עם מטריצת השונות המשותפת ההיסטורית, כיצד נוכל להשתפר? הפתרון היעיל והנפוץ ביותר הוא **shrinkage (כיווץ)**. הרעיון הוא לקחת את מטריצת השונות המשותפת ההיסטורית הרועשת והבלתי יציבה ו"לכווץ" אותה לעבר מטרה מובנית ויציבה יותר. מטרה נפוצה היא מטריצת היחידה, המניחה שלכל המניות יש אותה שונות והן אינן מתואמות זו עם זו.

אומדן ה-**Ledoit-Wolf shrinkage** הוא טכניקה רבת עוצמה המחשבת את עוצמת הכיווץ האופטימלית - הכמות האופטימלית לכווץ את המטריצה ההיסטורית לעבר המטרה - בהתבסס על התכונות הסטטיסטיות של הנתונים עצמם. התוצאה היא מטריצת שונות משותפת שהיא גם יציבה יותר וגם מדויקת יותר מהאומדן ההיסטורי הגולמי.

## העולם האמיתי: אילוצים ונטרול

פורטפוליו MVO גולמי ובלתי מוגבל הוא לעתים קרובות לא פורטפוליו מעשי בעולם האמיתי. הוא עשוי להיות מרוכז מאוד בכמה מניות, להיות בעל הימורים גדולים ולא מכוונים על סקטורים מסוימים, ולדרוש כמות עצומה של תחלופה ליישום. כאן נכנסים לתמונה אילוצים ונטרול.

**שפת האילוצים:**
אנו יכולים להוסיף מגוון של אילוצים ליניאריים וריבועיים לבעיית ה-MVO כדי להפוך את הפורטפוליו המתקבל למעשי וחזק יותר:
*   **אילוצי קופסה (Box Constraints):** אלו הם גבולות עליונים ותחתונים פשוטים על משקל של כל מניה בודדת (למשל, *0 <= w<sub>i</sub> <= 0.02*).
*   **אילוצי סקטור (Sector Constraints):** אלו הן מגבלות על החשיפה הכוללת של הפורטפוליו לכל תעשייה נתונה (למשל, *0.15 <= w<sub>tech</sub> <= 0.25*).
*   **אילוצי תחלופה (Turnover Constraints):** אלו מגבילים את כמות המסחר הכוללת שניתן לבצע בכל תקופת איזון מחדש, דבר שהוא חיוני לשליטה בעלויות עסקה.
*   **אילוצי פקטור (Factor Constraints):** אלו הם אילוצים על חשיפת הפורטפוליו לגורמי סיכון נפוצים, שהם המפתח לנטרול.

אילוצים אלה מטופלים מתמטית על ידי סט של טכניקות המכונות **אופטימיזציה עם אילוצים (constrained optimization)**, המשתמשות ב**תנאי Karush-Kuhn-Tucker (KKT)** כדי למצוא את הפתרון האופטימלי.

**אמנות הנטרול:**
נטרול הוא תהליך של בניית הימור "טהור" על הסיגנל הרצוי שלנו על ידי הסרת השפעתם של גורמים אחרים, לא רצויים. לדוגמה, אם יש לנו סיגנל מצוין לבחירת מניות בסקטור הטכנולוגיה, אך אין לנו דעה על סקטור הטכנולוגיה בכללותו, אנו יכולים לבנות פורטפוליו **ניטרלי-סקטוריאלית (sector-neutral)**. לפורטפוליו זה יהיה אותו משקל כולל בסקטור הטכנולוגיה כמו ה-benchmark שלנו, אך בתוך אותו סקטור, הוא יהיה long על המניות עם ציוני סיגנל גבוהים ו-short על המניות עם ציוני סיגנל נמוכים.

ישנן שתי דרכים עיקריות להשיג נטרול:
1.  **נטרול לפני-הסיגנל (Residualization):** עוד לפני שאנו מתחילים את תהליך בניית הפורטפוליו, אנו יכולים לנטרל את הסיגנל עצמו. אנו עושים זאת על ידי הרצת רגרסיה של ציוני הסיגנל הגולמיים על סט של חשיפות פקטורים (למשל, משתני דמה סקטוריאליים, בטא שוק). ה-**residual** מרגרסיה זו הוא סיגנל חדש, ניטרלי-לפקטור, שבו נוכל להשתמש אז כקלט לשיטת השקלול שלנו.
2.  **נטרול תוך-הפורטפוליו (Optimization):** לחלופין, אנו יכולים לאכוף נטרול ישירות בתוך מסגרת ה-MVO. אנו עושים זאת על ידי הוספת סט של אילוצים ליניאריים המאלצים את הפורטפוליו הסופי להיות בעל חשיפה אפסית (או מטרה אחרת כלשהי) לגורמים הלא רצויים. לדוגמה, כדי לבנות פורטפוליו ניטרלי-שוק, נוסיף את האילוץ שהבטא של הפורטפוליו ביחס לשוק חייבת להיות שווה לאפס.

## מסקנה: האדריכל של הפורטפוליו

אם חוקר הסיגנלים הוא הסייר שמוצא את השטח המבטיח, בונה הפורטפוליו הוא האדריכל שמתכנן את המבנה הסופי והראוי למגורים. זהו תפקיד הדורש שילוב ייחודי של קפדנות כמותית, שיפוט אמנותי, והבנה עמוקה של חיכוכי העולם האמיתי.

הבחירות שנעשות בתהליך בניית הפורטפוליו - שיטת השקלול, האילוצים, אסטרטגיית הנטרול - חשובות לא פחות מהסיגנלים עצמם בקביעת ההצלחה או הכישלון הסופיים של אסטרטגיית השקעה כמותית. סיגנל מצוין יכול להתבזבז על ידי תהליך בניית פורטפוליו נאיבי, בעוד שסיגנל בינוני יכול להשתפר משמעותית על ידי תהליך מחושב וחזק. בונה הפורטפוליו הוא הגיבור הבלתי מושר של העולם הכמותי, זה שהופך את היופי המופשט של הסיגנל למציאות המוחשית של פורטפוליו רווחי ומנוהל-סיכונים.
# פרק 5 - שקלול, אילוצים ונטרול

***

## למה הפרק הזה חשוב

בפרקים הקודמים, עשינו את העבודה הקשה של יצירת סיגנלים מבטיחים וזיהוי משטר השוק הנוכחי. כעת יש לנו רשימה של מניות שאנו חושבים שצפויות להניב תשואות גבוהות יותר. אבל איך אנחנו מתרגמים את הרשימה הזו לתיק השקעות בעולם האמיתי? זהו השלב המכריע, ולעתים קרובות מתעלמים ממנו, של **בניית תיק השקעות (portfolio construction)**.

זה לא פשוט כמו לקנות את המניות המדורגות הגבוהות ביותר שלנו. אנחנו צריכים להחליט *כמה* מכל מניה לקנות. זוהי החלטת ה**שקלול (weighting)**. אנחנו צריכים גם להיות מודעים ל**אילוצים (constraints)** של העולם האמיתי, כגון מגבלות על החשיפה שלנו לכל מניה, סקטור או מדינה בודדים. ואנחנו צריכים להבטיח שהתיק שלנו לא עושה הימורים לא מכוונים - תהליך שנקרא **נטרול (neutralization)**.

פרק זה הוא הגשר מציונים מופשטים לתיק השקעות סחיר ומנוהל סיכונים. תיק השקעות שנבנה בצורה גרועה יכול להפוך סיגנל נהדר לאסטרטגיה מפסידה. תיק השקעות בנוי היטב יכול לשפר את הביצועים של סיגנל טוב, ובאותה מידה של חשיבות, להגן עלינו מעצמנו.

## רעיונות מרכזיים

- **סכמות שקלול:** איך אנחנו מחליטים על גודל הפוזיציה שלנו בכל מניה?
    - **עשרונים שווי משקל:** גישה פשוטה וחזקה. אנו מדרגים את כל המניות לפי הסיגנל שלנו, מחלקים אותן לעשרה עשרונים, ואז נותנים משקל שווה לכל מניה בעשירון העליון.
    - **שקלול Softmax:** שיטה מתוחכמת יותר המקצה משקלים על סמך גודל ציון הסיגנל. הנוסחה היא:

      *w<sub>i</sub> = e<sup>τs<sub>i</sub></sup> / Σ<sub>j</sub>e<sup>τs<sub>j</sub></sup>*

      כאשר *w<sub>i</sub>* הוא המשקל של מניה *i*, *s<sub>i</sub>* הוא ציון הסיגנל שלה, ו-*τ* (טאו) הוא פרמטר השולט בריכוזיות התיק. *τ* גבוה יותר מוביל לתיק מרוכז יותר.

- **אילוצים:** העולם האמיתי מטיל מגבלות על תיקי ההשקעות שלנו. אלה יכולים לכלול:
    - **אילוצי קופסה (Box Constraints):** מגבלות על המשקל המרבי של כל פוזיציה בודדת (למשל, לא יותר מ-2% מהתיק).
    - **אילוצים סקטוריאליים:** מגבלות על החשיפה שלנו לכל ענף בודד (למשל, לא יותר מ-20% במניות טכנולוגיה).
    - **אילוצי תחלופה (Turnover Constraints):** מגבלות על כמות המסחר שאנו יכולים לבצע בתקופה נתונה, על מנת לשלוט בעלויות העסקה.
    - **השתתפות ב-ADV:** מגבלות על נפח המסחר היומי שלנו במניה כאחוז מנפח המסחר היומי הממוצע שלה (ADV), כדי למנוע הזזת המחיר נגדנו.
    - **מאגרי מזומנים:** החזקת כמות מסוימת של מזומנים כדי לעמוד בפדיונות בלתי צפויים או כדי לנצל הזדמנויות חדשות.

- **נטרול:** תהליך הסרת חשיפות פקטור לא רצויות מהתיק שלנו. אם הסיגנל שלנו מוטה כלפי מניות קטנות, ייתכן שנרצה לנטרל חשיפה זו כדי לבצע הימור טהור על הסיגנל עצמו. אנחנו יכולים לעשות זאת באמצעות:
    - **שיוריות (Residualization):** כפי שראינו בפרק 3, אנו יכולים לבצע רגרסיה של הסיגנל שלנו על קבוצה של חשיפות פקטור ולהשתמש בשארית כסיגנל ניטרלי לפקטור.
    - **אופטימיזציה:** אנו יכולים להשתמש באופטימיזטור תיקים כדי לבנות תיק בעל החשיפה הגבוהה ביותר האפשרית לסיגנל הרצוי שלנו, בכפוף לאילוץ שחשיפתו לכל שאר הפקטורים הלא רצויים היא אפס.

## מתמטיקה שתשתמשו בה

### אופטימיזציית ממוצע-שונות

בעיית אופטימיזציית התיקים הקלאסית, שנוסחה על ידי הארי מרקוביץ', היא למצוא את התיק שממקסם את התשואה לרמת סיכון נתונה. הנוסחה היא:

**max μ<sup>T</sup>w - λw<sup>T</sup>Σw**

כאשר:
- *w* הוא וקטור משקלי התיק.
- *μ* הוא וקטור התשואות הצפויות (ציוני הסיגנל שלנו).
- *Σ* היא מטריצת השונות המשותפת של תשואות הנכסים.
- *λ* (למדא) הוא פרמטר שנאת הסיכון. *λ* גבוה יותר אומר שאכפת לנו יותר למזער סיכון ופחות למקסם תשואה.

### תנאי KKT

תנאי Karush-Kuhn-Tucker (KKT) הם הכללים המתמטיים שתיק חייב לספק כדי להיות הפתרון האופטימלי לבעיית אופטימיזציה עם אילוצים. הם הכללה של שיטת מכפיל לגראנז' לטיפול באילוצי אי-שוויון (כמו אילוצי הקופסה והסקטור שלנו).

### כיווץ לדו-וולף (Ledoit-Wolf Shrinkage)

האתגר הגדול ביותר באופטימיזציית ממוצע-שונות הוא הערכת מטריצת השונות המשותפת, *Σ*. מטריצת השונות המשותפת ההיסטורית היא לעתים קרובות לא יציבה ויכולה להוביל למשקלי תיק קיצוניים ולא אינטואיטיביים. **כיווץ (Shrinkage)** היא טכניקה לשיפור יציבות מטריצת השונות המשותפת על ידי "כיווץ" שלה לעבר מטרה מובנית ויציבה יותר, כגון מטריצת היחידה. שיטת לדו-וולף היא דרך פופולרית ויעילה לעשות זאת.

## דוגמה נרטיבית: מרשימת העשירון העליון לתיק סחיר

אנליסטית פיתחה סיגנל חדש ומבריק לחיזוי הפתעות ברווחים. היא בודקת לאחור אסטרטגיה פשוטה של קניית העשירון העליון של מניות המדורגות לפי הסיגנל שלה והחזקתן למשך חודש. הבדיקה לאחור נראית פנטסטית.

אבל כשהיא מנסה ליישם את האסטרטגיה בעולם האמיתי, היא נתקלת בבעיות. תיק העשירון העליון שלה מרוכז בכבדות בכמה מניות ביוטק קטנות ולא נזילות. כשהיא מנסה לקנות אותן, המחיר זז נגדה, ועלויות העסקה שלה עצומות. התיק גם חשוף בכבדות לפקטור המומנטום, שהיא לא רוצה.

כאן נכנסת לתמונה בניית התיק. במקום פשוט לקנות את העשירון העליון, היא יכולה להשתמש באופטימיזטור ממוצע-שונות עם האילוצים הבאים:

-   משקל מרבי של 2% בכל מניה בודדת.
-   משקלים סקטוריאליים שנמצאים בטווח של +/- 5% ממשקלי הסקטור של המדד.
-   בטא של 1.0 לשוק.
-   חשיפה אפסית לפקטור המומנטום.

לתיק שיתקבל תהיה תשואה צפויה מעט נמוכה יותר מהתיק המקורי והלא מוגבל. אבל הוא יהיה הרבה יותר חזק, סחיר ומגוון. זהו תיק שיכול לשרוד בפתיחה.

## תרגול מעשי: השוואת סכמות שקלול

1.  **קחו את הסיגנל המורכב שלכם:** קחו את הסיגנל המורכב שבניתם בפרק 3.
2.  **בנו שלושה תיקים:** בנו שלושה תיקים שונים המבוססים על סיגנל זה:
    א. תיק שווה משקל של העשירון העליון של המניות.
    ב. תיק משוקלל softmax. התנסו עם ערכים שונים של פרמטר הריכוזיות, τ.
    ג. תיק מותאם ממוצע-שונות עם אילוצים סבירים (למשל, משקל מרבי של 2%, אילוצים סקטוריאליים).
3.  **השתמשו בכיווץ:** עבור תיק הממוצע-שונות, השתמשו באומדן כיווץ לדו-וולף עבור מטריצת השונות המשותפת.
4.  **השוו ונתחו:** השוו את הביצועים והמאפיינים של שלושת התיקים. הסתכלו על:
    -   תשואות מתואמות סיכון (יחס שארפ).
    -   תחלופה.
    -   ריכוזיות (מדד הרפינדל).
    -   חשיפה לגורמי סיכון נפוצים (בטא, סקטורים וכו').
    -   שרטטו את משקלי התיק של כל אסטרטגיה לאורך זמן. במה הם שונים?

## בחן את עצמך

- מהי מטרת הפרמטר *τ* בסכמת השקלול softmax?
- מהם תנאי KKT, ומדוע הם חשובים לאופטימיזציית תיקים?
- מדוע מטריצת השונות המשותפת ההיסטורית היא לעתים קרובות קלט גרוע לאופטימיזטור ממוצע-שונות?
- כיצד היית בונה תיק ניטרלי לדולר האמריקאי?

## מלכודות נפוצות

- **חוסר יציבות של אופטימיזטור:** אופטימיזטורים של ממוצע-שונות ידועים לשמצה ברגישותם לשינויים קטנים בקלטים (תשואות צפויות ושונות משותפת). הדבר עלול להוביל לתנודות גדולות ולא מוצדקות במשקלי התיק. שימוש בכיווץ ובאילוצים חזקים הוא חיוני.
- **הערכת שונות משותפת שגויה:** מטריצת השונות המשותפת היא הקלט החשוב ביותר, והקשה ביותר, לקבל נכון. מטריצת שונות משותפת מוערכת בצורה גרועה יכולה להוביל לתיק שנראה אופטימלי על הנייר אך למעשה הוא מסוכן מאוד.
- **הימורי פקטור נסתרים:** אם אינכם מנטרלים במפורש את חשיפת התיק שלכם לפקטורים ידועים, אתם עלולים לבצע הימור גדול ולא מכוון. תמיד הריצו ניתוח פקטורים על התיק הסופי שלכם כדי להבין מאיפה מגיע הסיכון שלכם.
- **התעלמות מעלויות עסקה:** התיק האופטימלי על הנייר עשוי להיות יקר מאוד למסחר. נטפל בזה בפירוט בפרק 8.

## נקודות עיקריות

-   בניית תיק השקעות היא השלב המכריע שמתרגם סיגנלים לתיק סחיר.
-   ישנן דרכים רבות ושונות לשקלל מניות, החל משקלול שווה פשוט ועד לאופטימיזציית ממוצע-שונות מתוחכמת.
-   יש לשלב אילוצים מהעולם האמיתי, כגון מגבלות על גודל פוזיציות ותחלופה, בתהליך בניית התיק.
-   נטרול חשיפות פקטור לא רצויות חיוני לבניית הימור טהור על הסיגנל שלכם.

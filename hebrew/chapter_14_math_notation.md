# פרק 14 - בלוקים מתמטיים מינימליים וסימון (מאוחד)

***

## למה הפרק הזה חשוב

ספר זה כיסה מגוון רחב של מושגים מתמטיים וסטטיסטיים. פרק זה משמש כמדריך עזר מאוחד לנוסחאות, הגזירות והסימונים החשובים ביותר ששימשו לאורך הספר. הוא נועד להיות מקום מהיר וקל לחפש הגדרה או לרענן את הזיכרון על גזירה מרכזית.

אין חומר חדש בפרק זה. זהו פשוט ארגון מחדש ותמצות של התוכן המתמטי מהפרקים הקודמים. השתמשו בו כמדריך לימוד, דף נוסחאות, או נקודת התחלה לספריית הקוד הכמותי שלכם.

## בלוקים מתמטיים מרכזיים

### תשואות

- **תשואה פשוטה:** *R<sub>t</sub> = (P<sub>t</sub> / P<sub>t-1</sub>) - 1*
- **תשואה לוגריתמית:** *r<sub>t</sub> = ln(P<sub>t</sub> / P<sub>t-1</sub>)*
- **קשר:** *r<sub>t</sub> = ln(1 + R<sub>t</sub>)*

### סיכון וביצועים

- **תשואה לוגריתמית שנתית:** *252 \* r<sub>d</sub>*
- **תנודתיות שנתית:** *σ<sub>d</sub> \* √252*
- **יחס שארפ:** *(E[R] - R<sub>f</sub>) / σ[R]*

### מודלי פקטורים

- **CAPM:** *E[R<sub>i</sub>] - R<sub>f</sub> = β<sub>i</sub>(E[R<sub>m</sub>] - R<sub>f</sub>)*
- **בטא OLS:** *β̂ = Cov(r, r<sub>m</sub>) / Var(r<sub>m</sub>)*
- **אלפא OLS:** *α̂ = E[r] - β̂E[r<sub>m</sub>]*

### בניית תיק

- **שקלול Softmax:** *w<sub>i</sub> = e<sup>τs<sub>i</sub></sup> / Σ<sub>j</sub>e<sup>τs<sub>j</sub></sup>*
- **אופטימיזציית ממוצע-שונות:** *max μ<sup>T</sup>w - λw<sup>T</sup>Σw*

### ניהול סיכונים

- **שונות EWMA:** *σ̂<sup>2</sup><sub>t</sub> = λσ̂<sup>2</sup><sub>t-1</sub> + (1-λ)r<sup>2</sup><sub>t-1</sub>*
- **סקיילינג יעד תנודתיות:** *k = σ<sub>tgt</sub> / σ̂*
- **קריטריון קלי לנכס בודד:** *ℓ\* ≈ μ / σ<sup>2</sup>*
- **קריטריון קלי מרובה נכסים:** *w\* ∝ Σ<sup>-1</sup>μ*

## גזירות מפתח

### תנאי KKT לאופטימיזציית ממוצע-שונות עם אילוצי קופסה

שקלו את הבעיה של מקסום פונקציית המטרה של ממוצע-שונות בכפוף לקבוצה של אילוצי קופסה על המשקלים (למשל, 0 ≤ w<sub>i</sub> ≤ 0.02). הלגראנז'יאן לבעיה זו הוא:

*L(w, λ, μ) = μ<sup>T</sup>w - λw<sup>T</sup>Σw - Σ<sub>i</sub>λ<sub>i</sub>(w<sub>i</sub> - w<sub>max</sub>) - Σ<sub>i</sub>μ<sub>i</sub>(-w<sub>i</sub>)*

כאשר *λ<sub>i</sub>* ו-*μ<sub>i</sub>* הם מכפילי לגראנז' עבור אילוצי הגבול העליון והתחתון, בהתאמה.

תנאי KKT הם קבוצה של תנאים הכרחיים כדי שפתרון יהיה אופטימלי. הם קובעים שבפתרון האופטימלי, הגרדיאנט של הלגראנז'יאן ביחס ל-*w* חייב להיות אפס, ותנאי הרפיון המשלים חייבים להתקיים. זה מוביל למערכת משוואות שניתן לפתור כדי למצוא את משקלי התיק האופטימליים.

### ירידת גרדיאנט מושלכת (Projected Gradient Descent)

ירידת גרדיאנט מושלכת היא אלגוריתם איטרטיבי לפתרון בעיות אופטימיזציה עם אילוצים. הרעיון הוא לקחת צעד בכיוון הגרדיאנט של פונקציית המטרה, ואז "להשליך" את הנקודה המתקבלת בחזרה על הסט האפשרי המוגדר על ידי האילוצים. עבור אילוצי קופסה, שלב ההשלכה הוא פשוט: אתם פשוט חוסמים את המשקלים בגבולות העליונים והתחתונים שלהם.

## טבלת סמלים

| סמל | הגדרה |
|---|---|
| *P<sub>t</sub>* | מחיר בזמן *t* |
| *R<sub>t</sub>* | תשואה פשוטה |
| *r<sub>t</sub>* | תשואה לוגריתמית |
| *σ* | תנודתיות (סטיית תקן) |
| *β* | בטא (טעינת פקטור) |
| *α* | אלפא (עודף תשואה מתואם סיכון) |
| *μ* | תשואה צפויה |
| *Σ* | מטריצת שונות משותפת |
| *w* | וקטור משקלי תיק |
| *λ* | פרמטר שנאת סיכון או מקדם דעיכה EWMA |
| *τ* | פרמטר ריכוזיות Softmax |
| *ℓ\** | שבר קלי אופטימלי |

## תרגול מעשי: יישום אלגוריתמים מרכזיים

כדי לחזק את הבנתכם במושגים מתמטיים אלה, מומלץ מאוד ליישם אותם מאפס בשפת התכנות המועדפת עליכם. הנה כמה הצעות:

1.  **כיווץ לדו-וולף:** כתבו פונקציה שלוקחת סדרת זמן של תשואות נכסים ומחזירה מטריצת שונות משותפת מכווצת באמצעות נוסחת לדו-וולף.
2.  **שגיאות תקן HAC/Newey–West:** ישמו את נוהל Newey-West להערכת שגיאות תקן של מקדמי רגרסיה שהן חסינות להטרוסקדסטיות ואוטוקורלציה.
3.  **Block Bootstrap:** כתבו פונקציה לביצוע block bootstrap על סדרת זמן של תשואות. השתמשו בזה לבניית רווח סמך ליחס שארפ.
4.  **ירידת גרדיאנט מושלכת:** ישמו את אלגוריתם ירידת הגרדיאנט המושלכת לפתרון בעיית אופטימיזציית ממוצע-שונות עם אילוצי קופסה. השוו את התוצאות שלכם לספריית אופטימיזציה קמורה מהמדף.

## נקודות עיקריות

-   הבנה מוצקה של מושגי הליבה המתמטיים חיונית לכל משקיע כמותי.
-   פרק זה משמש כמדריך עזר מהיר לנוסחאות ולסימונים המרכזיים המשמשים בספר זה.
-   יישום אלגוריתמים אלה מאפס הוא דרך נהדרת לחזק את הבנתכם.

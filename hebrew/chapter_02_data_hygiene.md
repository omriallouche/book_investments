# פרק 2: היגיינת נתונים ויושרה מחקרית (Point-in-Time או לא כלום)

***

## פרולוג: האנליסט ורוח הרפאים של ג'נרל מוטורס

באמצע 2008, אנליסט צעיר ושאפתן בקרן גידור יוקרתית מקבל משימה לבנות אסטרטגיית value פשוטה אך חזקה. השוק מראה סימני לחץ, ושותפי הקרן מחפשים אסטרטגיה הגנתית לטווח ארוך כדי לצלוח את הסערה המתקרבת. האנליסט, חמוש ב-MBA מהשורה הראשונה ובמנוי חדש ועוצמתי למאגר נתונים, מתכנן backtest שנראה ללא דופי. הכללים פשוטים: בתחילת כל שנה, מ-1980 עד 2008, המודל יבחר את 50 המניות במדד S&P 500 עם יחס המחיר לרווח (P/E) הנמוך ביותר - מדד value קלאסי. הפורטפוליו יהיה שווה-משקל ויאוזן מחדש מדי שנה.

האנליסט מריץ את ה-backtest. התוצאות עוצרות נשימה. האסטרטגיה מניבה תשואה שנתית עקבית של 18%, ומכה בקלות את מדד S&P 500 עם תנודתיות נמוכה יותר. הפורטפוליו נראה כמעט כנס, ומייצר תשואות חזקות אפילו במהלך התפוצצות בועת הדוט-קום בשנים 2000-2002. השותפים מתרשמים, והאסטרטגיה נכנסת מיד לייצור עם הקצאת הון משמעותית בתחילת 2009.

במשך כמה חודשים, האסטרטגיה מתפקדת היטב. אבל אז, משהו מוזר מתחיל לקרות. הפורטפוליו הופך למרוכז בכבדות בקומץ של חברות רכב ופיננסים מתקשות. עד אמצע 2009, האסטרטגיה ספגה drawdown קטסטרופלי של 60%, שמחק שנים של רווחים מדומים תוך חודשים ספורים. האנליסט מפוטר, והקרן נותרת המומה.

מה השתבש? האנליסט נפל קורבן לאחת הטעויות המפתות והמסוכנות ביותר בכל עולם הפיננסים הכמותי. מאגר הנתונים שלו, על כל יוקרתו, לא היה ייצוג **point-in-time** אמיתי של ההיסטוריה. כאשר הוא שאל את מאגר הנתונים על יחס ה-P/E של ג'נרל מוטורס בשנת 1995, מאגר הנתונים החזיר לו בחביבות את המחיר משנת 1995 חלקי הרווחים *כפי שהיו ידועים בשנת 2008*. הוא לא לקח בחשבון את התיקונים, ההצהרות מחדש, והשינויים החשבונאיים הרבים שהתרחשו במהלך 13 השנים שחלפו. באופן ערמומי עוד יותר, רשימת חברות ה-S&P 500 שלו התבססה על חברות המדד בשנת 2008. היא השמיטה בנוחות בית קברות שלם של ענקיות תעשייה לשעבר שפשטו את הרגל במהלך העשורים הקודמים. ה-backtest שלו הביט, מבלי משים, אל העתיד, ויצר פורטפוליו של חברות שלא רק נראו זולות בעבר, אלא גם הובטחו להיות שורדות בעתיד. הוא בנה מכונת זמן, והיא הובילה אותו, ואת הקרן שלו, אל עברי פי פחת.

סיפור זה, ואינספור אחרים כמוהו, הוא הסיבה לכך שפרק זה עשוי להיות החשוב ביותר בספר כולו. לפני שנוכל ללמוד כיצד לבנות, עלינו ללמוד תחילה כיצד לא להיכשל. ברוכים הבאים לעולם היגיינת הנתונים, סלע היסוד שעליו בנוי כל מחקר כמותי אמין.

## היררכיית חטאי הנתונים: טקסונומיה של הטיות

ב"תופת" של דנטה, חוטאים נענשים במדורים שונים של הגיהנום בהתאם לחומרת חטאיהם. כך גם בפיננסים כמותיים, קיימת היררכיה של הטיות נתונים, מהברורות והקלות לתיקון ועד למתוחכמות והערמומיות ביותר.

**רמה 1: הטיית הישרדות (Survivorship Bias) (חטא ההשמטה)**
זוהי הידועה והפשוטה ביותר מבין הטיות הנתונים. הטיית הישרדות היא הנטייה להתמקד ב"שורדים" של תהליך כלשהו ולהתעלם בשוגג מה"כישלונות".
*   **חברות במדד:** כפי שבפרולוג שלנו, שימוש ברשימה עדכנית של חברות במדד כדי לחקור את העבר הוא הדוגמה הקלאסית. אתה משמיט את כל החברות שהיו פעם במדד אך נמחקו מאוחר יותר עקב פשיטת רגל, רכישה או ביצועים גרועים. מכיוון שבהגדרה, אלו הם המפסידים, התוצאות שלך יהיו מנופחות באופן מלאכותי.
*   **מאגרי מידע של קרנות גידור:** מאגרי מידע מסחריים של קרנות גידור הם מקור ידוע לשמצה נוסף להטיית הישרדות. קרנות נוטות לדווח על ביצועיהן רק כאשר הם טובים. כאשר הן מתפקדות גרוע, הן מפסיקות לדווח לעתים קרובות, ואם הן יוצאות מהעסק, כל ההיסטוריה שלהן עלולה להימחק ממאגר הנתונים. זה מוביל להטיה משמעותית כלפי מעלה בתשואות המדווחות של קרנות גידור.
*   **התיקון:** התרופה היחידה להטיית הישרדות היא להתעקש על מאגר נתונים **נקי-מהטיית-הישרדות (survivorship-bias-free)**. עבור נתוני מניות, משמעות הדבר היא מאגר נתונים הכולל כל נייר ערך שנסחר אי פעם בבורסה, יחד עם התאריכים והסיבות למחיקתו. עבור נתוני קרנות גידור, משמעות הדבר היא להיות סקפטיים מאוד לגבי התשואות המדווחות ולהבין את אופי הדיווח העצמי של הנתונים.

**רמה 2: הטיית הצצה לעתיד (Look-Ahead Bias) (חטא הראייה למרחוק)**
זוהי קטגוריה מתוחכמת ומסוכנת יותר של הטיה. הטיית הצצה לעתיד מתרחשת כאשר מודל משתמש במידע שלא היה זמין בזמן קבלת החלטת ההשקעה.
*   **הטיית הצצה לעתיד קלאסית:** זוהי הצורה הישירה ביותר. לדוגמה, חברה עשויה לדווח על רווחיה לרבעון הרביעי ב-15 בפברואר. backtest המשתמש בנתוני רווחים אלה כדי לקבל החלטת מסחר ב-1 ביוניאר הוא מציץ לעתיד. התיקון הוא להחזיק במאגר נתונים עם **תאריכי הכרזה (announcement dates)** מדויקים עבור כל פיסת מידע ולהשתמש רק במידע בתאריך ההכרזה שלו או אחריו.
*   **הטיית הצהרה מחדש (Restatement Bias):** חברות לעתים קרובות מצהירות מחדש על הדוחות הכספיים הקודמים שלהן. מאגר נתונים שאינו point-in-time יחליף לעתים קרובות את הנתונים המקוריים בנתונים המתוקנים, וייצור אשליה שידעת את המספר ה"נכון" כל הזמן. מאגר נתונים point-in-time אמיתי ישמר את הנתונים המקוריים ואת הנתונים המתוקנים כשתי רשומות נפרדות, כל אחת עם תאריך ההכרזה שלה.
*   **הטיית הסוחר (Trader’s Bias):** זוהי צורה מתוחכמת של הטיית הצצה לעתיד המתרחשת בביצוע עסקאות. לדוגמה, מודל עשוי לייצר אות "קנייה" המבוסס על אירוע חדשותי שהתרחש בשעה 15:55. backtest המניח שניתן היה לבצע את העסקה במחיר הסגירה של 16:00 הוא ככל הנראה פגום. בחמש הדקות שבין החדשות לסגירה, המחיר כבר הספיק לזוז באופן משמעותי. התיקון הוא להשתמש בנתונים גרנולריים יותר, תוך-יומיים, ולהניח הנחות ריאליות לגבי עיכובים בביצוע.

**רמה 3: ריגול נתונים / התאמת יתר (Data Snooping / Overfitting) (חטא העינויים)**
זוהי ההטיה הערמומית והעצמית ביותר מכל הטיות הנתונים. היא מתרחשת כאשר חוקר מנסה יותר מדי מודלים, משתנים ופרמטרים שונים על אותו מאגר נתונים. על ידי עינוי חוזר ונשנה של הנתונים, החוקר חייב בסופו של דבר למצוא מודל שנראה טוב אך ורק במקרה. במהות, החוקר משתמש במידע מתוצאות ה-backtests שלו כדי ליידע את עיצוב המודל שלו. זוהי צורה של הטיית הצצה לעתיד, שבה המידע מה"עתיד" (תוצאות ה-backtest) דולף לתהליך יצירת המודל.
*   **התיקון:** אין תיקון מושלם ל-data snooping, אך ישנן מספר שיטות עבודה מומלצות שיכולות להפחית את הסיכון:
    1.  **החזק בהיפותזה מוקדמת חזקה:** התחל עם תיאוריה כלכלית או התנהגותית ברורה לגבי הסיבה שהאסטרטגיה צריכה לעבוד. אל תזרוק סתם משתנים על הקיר כדי לראות מה נדבק.
    2.  **החזק נתוני מחוץ-למדגם (Out-of-Sample):** שים בצד חלק מהנתונים ההיסטוריים שלך (למשל, חמש השנים האחרונות) כמאגר נתונים נקי ובלתי נגוע "מחוץ-למדגם". בצע את כל פיתוח המודל והבדיקות שלך על נתוני ה-"in-sample". כאשר אתה חושב שיש לך מודל סופי וחזק, בדוק אותו פעם אחת, ורק פעם אחת, על הנתונים שמחוץ-למדגם. אם זה לא עובד מחוץ-למדגם, עליך להיות מוכן לזרוק אותו ולהתחיל מחדש.
    3.  **היה סקפטי לגבי מורכבות:** מודל פשוט עם סיפור טוב הוא לעתים קרובות חזק יותר ממודל מורכב עם עשרות פרמטרים. כל פרמטר שאתה מוסיף למודל הוא עוד דרגת חופש שאתה נותן לו כדי להתאים את עצמו יתר על המידה לנתונים.

## האנטומיה של מאגר נתונים Point-in-Time (PIT)

מאגר נתונים point-in-time אמיתי אינו רק אוסף של טבלאות; זוהי קובייה ארבע-ממדית של מידע, כאשר הממדים הם נייר ערך, פריט נתונים, זמן וזמן הכרזה. זוהי הנדסה מורכבת ויקרה, אך היא היסוד החיוני למחקר אמין.

**מרכיבי המפתח:**
*   **Security Master:** זוהי מערכת העצבים המרכזית של מאגר הנתונים. היא מכילה מזהה ייחודי עבור כל נייר ערך שהתקיים אי פעם. באופן מכריע, היא חייבת להיות מסוגלת להתמודד עם האבולוציה המורכבת של חברה לאורך זמן. אם חברה א' רוכשת את חברה ב', ה-security master חייב להיות מסוגל לעקוב אחר קשר זה. אם חברה ג' מבצעת spin-off לחברה ד', ה-security master חייב ליצור רשומה חדשה עבור חברה ד' ולקשר אותה לחברת האם שלה. ללא security master חזק, אי אפשר לעקוב אחר ההיסטוריה של חברה במדויק.
*   **נתוני מחירים ופעולות תאגידיות:** רכיב זה מאחסן את נתוני המחיר והנפח היומיים (או התוך-יומיים) עבור כל נייר ערך. אך המחירים הגולמיים אינם מספיקים. נתונים אלה חייבים להיות משולבים באופן חלק עם יומן מפורט של כל הפעולות התאגידיות: פיצולים, דיבידנדים, מיזוגים, spin-offs, הנפקות זכויות וכו'. עבור כל פעולה תאגידית, מאגר הנתונים חייב לאחסן את תאריך ה-ex-date, תאריך התשלום, ואת התנאים המדויקים של הפעולה. זה מאפשר חישוב תוך-כדי-תנועה של **סדרת תשואה כוללת רציפה (continuous total return series)**, שהיא המדד האמיתי לחוויה ההיסטורית של המשקיע.
*   **נתונים פונדמנטליים Point-in-Time:** זהו החלק המורכב והיקר ביותר של מאגר נתונים PIT. עבור כל חברה, הוא חייב לאחסן היסטוריה מלאה של הדוחות הכספיים שלה (דוח רווח והפסד, מאזן, דוח תזרים מזומנים). אך הוא לא יכול לאחסן רק גרסה אחת של כל דוח. הוא חייב לאחסן כל גרסה שפורסמה אי פעם, יחד עם התאריך שבו הוכרזה. אם חברה מצהירה מחדש על רווחיה לשנת 2020 בשנת 2022, מאגר הנתונים חייב להכיל הן את הדוח המקורי של 2020 והן את הגרסה המתוקנת של 2022, כל אחת עם חותמת הזמן שלה. זוהי הדרך היחידה למדל במדויק את המידע שהיה זמין למשקיעים בכל נקודת זמן נתונה.
*   **חברות במדד Point-in-Time:** כדי למנוע הטיית הישרדות, מאגר הנתונים חייב להכיל רישום יומי של חברות כל המדדים העיקריים. זה מאפשר לחוקר לשחזר את יקום ההשקעות המדויק שעמד בפניו בכל יום נתון בעבר.

## המתמטיקה של התאמת נתונים

בואו נבחן מקרוב את תהליך יצירת סדרת תשואה כוללת רציפה. המטרה היא ליצור סדרת מחירים המותאמת באופן מלא לכל הפעולות התאגידיות, כאילו כל הדיבידנדים הושקעו מחדש וכל הפיצולים נלקחו בחשבון.

הכלי המרכזי לכך הוא **פקטור ההתאמה (adjustment factor)**. פקטור ההתאמה ליום נתון הוא מספר המגלם את ההשפעה של כל הפעולות התאגידיות שהתרחשו באותו יום. עבור דיבידנד מזומן פשוט, פקטור ההתאמה הוא:

*AF<sub>t</sub> = (P<sub>t-1</sub> - D<sub>t</sub>) / P<sub>t-1</sub> = 1 - D<sub>t</sub> / P<sub>t-1</sub>*

כאשר *P<sub>t-1</sub>* הוא מחיר הסגירה ביום שלפני ה-ex-dividend date, ו-*D<sub>t</sub>* הוא הדיבידנד למניה. עבור פיצול מניות של *S* מניות חדשות לכל מניה ישנה אחת, פקטור ההתאמה הוא פשוט *1/S*.

כדי ליצור סדרת מחירים מותאמת לחלוטין, אנו מתחילים מהמחיר העדכני ביותר ועובדים אחורה בזמן. המחיר המותאם בכל יום נתון הוא המחיר הלא-מותאם כפול פקטור התאמה מצטבר:

*P<sub>adj,t</sub> = P<sub>unadj,t</sub> * CAF<sub>t</sub>*

כאשר פקטור ההתאמה המצטבר *CAF<sub>t</sub>* הוא מכפלת כל פקטורי ההתאמה היומיים מיום *t+1* ועד היום.

*CAF<sub>t</sub> = AF<sub>t+1</sub> * AF<sub>t+2</sub> * ... * AF<sub>today</sub>*

תהליך זה מבטיח שהמחירים המותאמים ההיסטוריים הם השתקפות אמיתית של חוויית המשקיע. פיצול מניות של 2 ל-1 יגרום למחצית מכל המחירים ההיסטוריים, וישמר את רציפות סדרת התשואות. תשלום דיבידנד יגרום להורדת כל המחירים ההיסטוריים באחוז מקביל, כאילו הדיבידנד הושקע מחדש.

## בניית "מצפון נתונים": מדריך מעשי

בהתחשב באינספור המלכודות הפוטנציאליות של נתונים, כיצד יכול חוקר כמותי להגן על עצמו? התשובה טמונה בבניית "מצפון נתונים" קפדני, כמעט פרנואידי, בכל שלב של תהליך המחקר.

*   **אוטומציה של נתיב הביקורת (Audit Trail):** לכל פיסת נתונים במאגר הנתונים הנקי והסופי שלך צריכה להיות שושלת יוחסין ברורה וניתנת לביקורת. אתה אמור להיות מסוגל לעקוב אחר כל מספר חזרה לקובץ המקור שלו ולראות יומן של כל טרנספורמציה (למשל, התאמת פיצול, השקעה מחדש של דיבידנד, המרת מטבע) שהוחלה עליו. תהליך זה צריך להיות אוטומטי כחלק מצינור קליטת הנתונים שלך.
*   **אמץ את גישת ה-"Red Team":** באבטחת סייבר, "צוות אדום" הוא קבוצה של האקרים אתיים שמשלמים להם כדי לנסות לפרוץ למערכות של חברה. חברות השקעות כמותיות צריכות לאמץ גישה דומה. צריך להיות להן צוות חוקרים ייעודי שתפקידו אינו ליצור אסטרטגיות חדשות, אלא לנסות למצוא את הפגמים בנתונים וב-backtests של צוות המחקר הראשי. תהליך אדוורסריאלי זה הוא דרך רבת עוצמה לחשוף הטיות והנחות נסתרות.
*   **שמור על מאגר נתונים נקי מחוץ-למדגם:** כפי שנדון קודם, המשמעת של החזקת מאגר נתונים נקי ובלתי נגוע לאימות סופי היא אחד מכלי הנשק החזקים ביותר נגד התאמת יתר. זה דורש מחויבות תרבותית עמוקה בתוך חברה, שכן הפיתוי להציץ בנתונים שמחוץ-למדגם יכול להיות עצום.
*   **פתח רשימת תיוג להיגיינת נתונים:** לפני שכל אסטרטגיה חדשה נשקלת אפילו לייצור, היא צריכה לעבור רשימת תיוג קפדנית של היגיינת נתונים. רשימת תיוג זו צריכה לכלול שאלות כמו:
    *   האם הנתונים נקיים מהטיית הישרדות?
    *   האם כל הנתונים הם point-in-time?
    *   כיצד טופלו פעולות תאגידיות?
    *   מהן ההנחות לגבי עלויות עסקה וחיכוכי מסחר?
    *   האם האסטרטגיה נבדקה על נתונים מחוץ-למדגם?
    *   האם האסטרטגיה נבדקה על פני משטרי שוק שונים?

## מסקנה: ענוותנותו של ה-Quant

אם הפרק הראשון עסק ברעיונות הגדולים והמרגשים של הפיננסים הכמותיים, פרק זה היה מנה מפקחת של מציאות. זוהי תזכורת לכך שעבודתו של ה-quant אינה תמיד זוהרת. לעתים קרובות זוהי עבודה מפרכת, מוכוונת-פרטים, דרך העולם המבולגן והלא מושלם של נתונים פיננסיים. היא דורשת תחושה עמוקה של ענווה, מודעות מתמדת לפוטנציאל לטעות, ומחויבות בלתי נלאית ליושרה אינטלקטואלית.

אך דווקא משמעת זו היא שמפרידה בין המשקיע הכמותי המצליח לטווח ארוך לבין האנליסט החד-פעמי שמתמזל מזלו עם backtest פגום. בניית מבצר של יושרת נתונים סביב תהליך המחקר שלך אינה שלב מקדים; זוהי המשימה המרכזית. זהו מחיר הכניסה למשחק.
# פרק 10 - יישום מעשי (תדירות נמוכה, ידידותי ל-IBKR)

***

## למה הפרק הזה חשוב

כעת כיסינו את כל המרכיבים התיאורטיים העיקריים של תהליך השקעה כמותי. יש לנו סיגנלים, משטרים, בניית תיקים, ניהול סיכונים, ואפילו שכבות-על של אופציות. אבל איך אנחנו מחברים את כל זה לתהליך חזק, ניתן לחזרה ואוטומטי? פרק זה עוסק בצעדים המעשיים והמציאותיים של **יישום**.

נתמקד בגישה של **תדירות נמוכה**, כלומר אסטרטגיה המאזנת מחדש על בסיס חודשי או רבעוני. זוהי גישה ניתנת יותר לניהול ופחות יקרה עבור משקיע קמעונאי או מוסדי קטן. נשמור גם על היכולות והמגבלות של פלטפורמת ברוקראז' קמעונאית פופולרית, **אינטראקטיב ברוקרס (IBKR)**.

כאן התיאוריה פוגשת את המציאות. אסטרטגיה מבריקה שקיימת רק במחברת פייתון היא חסרת תועלת. מטרת פרק זה היא לתת לכם תוכנית לבניית תהליך השקעה מקצה לקצה בעולם האמיתי, שתוכלו להריץ בפועל, חודש אחר חודש.

## רעיונות מרכזיים

- **קצב (Cadence):** הקצב של תהליך ההשקעה שלכם. קצב חודשי טיפוסי עשוי להיראות כך:
    - **סוף החודש:** הורידו את כל הנתונים הדרושים (מחירים, דוחות כספיים, הערכות וכו').
    - **היום הראשון של החודש החדש:** הריצו את מודלי יצירת הסיגנלים, זיהוי המשטרים ובניית התיקים שלכם.
    - **היום השני של החודש החדש:** בצעו את העסקאות שלכם.
    - **לאורך כל החודש:** נטרו את הסיכון והביצועים של התיק שלכם.

- **צילום מצב (Snapshotting):** בכל שלב בתהליך שלכם, עליכם לשמור "צילום מצב" של הנתונים והמודלים שלכם. זה חיוני לשחזור ולניפוי שגיאות. לדוגמה, עליכם לשמור את הנתונים הגולמיים שהורדתם, את הסיגנלים שיצרתם, את משקלי התיק שחישבתם, ואת ההוראות ששלחתם לברוקר שלכם.

- **תצורה/ניהול גרסאות (Config/Versioning):** אסטרטגיית ההשקעה שלכם היא תוכנה. יש להתייחס אליה ככזו. זה אומר:
    - **קבצי תצורה:** כל הפרמטרים של האסטרטגיה שלכם (למשל, חלונות מבט לאחור, יעדי סיכון, הנחות עלויות עסקה) צריכים להיות מאוחסנים בקובץ תצורה נפרד, לא מקודדים בתוך התוכנית שלכם.
    - **בקרת גרסאות:** עליכם להשתמש במערכת בקרת גרסאות, כמו Git, כדי לעקוב אחר שינויים בקוד ובקבצי התצורה שלכם. זה מאפשר לכם לחזור לגרסה קודמת של האסטרטגיה שלכם אם אתם מגלים באג.

- **זרעים דטרמיניסטיים (Deterministic Seeds):** לכל חלק בתהליך שלכם הכולל אקראיות (למשל, מודלי למידת מכונה, bootstrapping), עליכם להגדיר **זרע דטרמיניסטי**. זה מבטיח שתקבלו בדיוק את אותן תוצאות בכל פעם שתריצו את הקוד עם אותם קלטים. זה חיוני לשחזור.

- **חלונות ביצוע מודעי דוחות רווח:** כפי שדנו בפרק 9, מסחר סביב הכרזות רווחים הוא מסוכן. כלל פשוט אך יעיל הוא להחזיק "חלון האפלה" שבו אינכם סוחרים במניה בימים הספורים שלפני ואחרי פרסום הדוחות שלה.

- **ייחוס (Attribution):** לאחר כל תקופת איזון מחדש, עליכם לבצע ניתוח **ייחוס ביצועים**. זה כולל פירוק תשואת התיק שלכם למקורותיה השונים:
    - **תשואת שוק:** התשואה מהבטא של התיק שלכם לשוק.
    - **תשואות פקטור:** התשואה מהחשיפה של התיק שלכם לפקטורים ידועים אחרים (למשל, ערך, מומנטום).
    - **תשואה ספציפית (אלפא):** התשואה השיורית שאינה מוסברת על ידי השוק או פקטורים אחרים. זוהי האלפא האמיתית שלכם.

## מתמטיקה/תהליך: ספר הריצה (Runbook)

**ספר ריצה** הוא מדריך מפורט, צעד אחר צעד, לתהליך ההשקעה שלכם. הוא צריך להיות כל כך ברור ומפורש שאדם אחר יוכל לעקוב אחריו ולשחזר את התוצאות שלכם בדיוק. ספר ריצה טוב יכלול:

- **לוח שנה לאיזון מחדש:** לוח זמנים של כל התאריכים והשעות המרכזיים לתהליך שלכם.
- **רשימות תיוג נתונים:** רשימה של כל הנתונים שעליכם להוריד, ובדיקות כדי להבטיח שהנתונים מלאים ונכונים.
- **הוראות ביצוע:** הוראות מפורטות כיצד ליצור את תיק המטרה שלכם ולבצע את העסקאות עם הברוקר שלכם.
- **ספרי משחק למצבי כשל:** מה אתם עושים אם משהו משתבש? מה אם הזנת נתונים מתעכבת? מה אם השוק נמצא במצב של limit-up? מה אם הקוד שלכם קורס? ספר משחק למצבי כשל נפוצים הוא סימן לתהליך ברמה מקצועית.

## דוגמה נרטיבית: ספר הריצה שמנע התפוצצות בשבוע הדוחות

אנליסט מריץ אסטרטגיית מומנטום חודשית. התהליך שלו הוא לאזן מחדש ביום המסחר הראשון של כל חודש. חודש אחד, הוא בחופשה במהלך שבוע האיזון מחדש, אז הוא מבקש מאנליסט זוטר להריץ את התהליך עבורו.

יש לו ספר ריצה מפורט המתעד כל שלב בתהליך. ספר הריצה כולל פריט ברשימת תיוג: "הצלבו את רשימת המניות למסחר עם לוח שנה של הכרזות רווחים קרובות. אל תסחרו באף מניה שיש לה הכרזת רווחים בחמשת ימי המסחר הבאים."

האנליסט הזוטר עוקב אחר ספר הריצה כלשונו. הוא מגלה שאחת ממניות המומנטום המובילות, חברת טכנולוגיה מצליחה, אמורה לדווח על רווחים בעוד יומיים. על פי ספר הריצה, אסור לו לסחור בה. הוא מדלג על העסקה ורושם הערה ביומן.

יומיים לאחר מכן, חברת הטכנולוגיה מדווחת על רווחים הרסניים, והמניה צונחת ב-50%. הכלל הפשוט וההגיוני של ספר הריצה הציל את התיק מהתפוצצות גדולה. זהו הערך של גישה ממושמעת ומונעת תהליכים.

## תרגול מעשי: בניית ספר ריצה תפעולי "עמוד אחד"

1.  **קחו את האסטרטגיה המלאה שלכם:** קחו את אסטרטגיית ההשקעה המלאה שפיתחתם לאורך ספר זה.
2.  **צרו ספר ריצה:** צרו ספר ריצה בן עמוד אחד המסכם את כל התהליך החודשי. זו צריכה להיות רשימת תיוג ברמה גבוהה המכסה את כל השלבים המרכזיים, מהורדת נתונים ועד ביצוע עסקאות וייחוס ביצועים.
3.  **צרו תבנית יומן מחקר:** צרו תבנית ל**יומן מחקר**. כאן תתעדו את כל רעיונות המחקר שלכם, תוצאות בדיקות לאחור ושינויים במודלים. יומן מחקר מתוחזק היטב חיוני למניעת ריגול נתונים ולמעקב אחר הקניין הרוחני שלכם.
4.  **אוטומציה של שלב:** בחרו שלב אחד בספר הריצה שלכם וכתבו סקריפט לאוטומציה שלו. לדוגמה, תוכלו לכתוב סקריפט להורדת כל הנתונים שלכם מרשימת מקורות, או סקריפט ליצירת דוח ייחוס ביצועים.

## בחן את עצמך

- מדוע חשוב להשתמש בבקרת גרסאות עבור קוד ההשקעות שלכם?
- מהו זרע דטרמיניסטי, ומדוע הוא חשוב?
- כיצד הייתם מחשבים את תרומת פקטור הערך לתשואת התיק שלכם?
- מה המשמעות של "ריצה ניתנת לשחזור מהתחלה קרה"?

## מלכודות נפוצות

- **תיקונים שקטים של ספקים:** ספק הנתונים שלכם עשוי לתקן בשקט נתונים היסטוריים מבלי לספר לכם. הדבר עלול לשנות את תוצאות הבדיקה לאחור שלכם. זו הסיבה שכל כך חשוב ל**צלם מצב** של הנתונים שלכם בכל נקודת זמן.
- **סחיפת פרמטרים:** הפרמטרים האופטימליים עבור המודל שלכם עשויים להשתנות עם הזמן. אתם צריכים שיהיה לכם תהליך להערכה מחודשת תקופתית של פרמטרי המודל שלכם על בסיס מתגלגל.
- **אי התאמה סביבתית:** סביבת המחקר שלכם (למשל, המחשב הנייד שלכם עם גרסה ספציפית של פייתון וספריותיה) עשויה להיות שונה מסביבת הייצור שלכם (למשל, שרת ענן). הדבר עלול להוביל לבאגים עדינים ולתוצאות שאינן ניתנות לשחזור. שימוש בכלים כמו Docker ליצירת סביבות עקביות הוא נוהג טוב.
- **שגיאות ידניות:** כל חלק בתהליך שלכם הכולל שלבים ידניים הוא מקור פוטנציאלי לשגיאות. המטרה צריכה להיות אוטומציה של כמה שיותר מהתהליך.

## נקודות עיקריות

-   תהליך יישום חזק וניתן לחזרה חשוב לא פחות מאסטרטגיית השקעה טובה.
-   ספר ריצה מפורט חיוני להבטחת עקביות ולניהול סיכונים תפעוליים.
-   בקרת גרסאות, צילום מצב וזרעים דטרמיניסטיים חיוניים לשחזור.
-   בצעו אוטומציה של כמה שיותר מהתהליך שלכם כדי להפחית את הסיכון לשגיאות ידניות.

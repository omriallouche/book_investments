# פרק 10: יישום מעשי (תדירות נמוכה, ידידותי ל-IBKR)

***

## פרולוג: רוח הרפאים במכונה

השעה 3:00 לפנות בוקר ביום שלישי, ומנהל פורטפוליו בקרן גידור כמותית של מיליארדי דולרים מתעורר בבהלה משיחת טלפון דחופה. אסטרטגיית ה-market-neutral המובילה של הקרן, פלא של תחכום סטטיסטי שהייתה רווחית במשך חמש שנים רצופות, מדממת פתאום כסף. הפורטפוליו, שאמור להיות בעל בטא אפס, נע באופן בלתי מוסבר בתיאום מושלם עם השוק, שנמצא בעיצומה של מכירת חיסול חדה. מערכת ניהול הסיכונים מהבהבת באדום, ושותפי הפירמה דורשים תשובות.

לאחר סשן דיבאגינג קדחתני של לילה שלם, מקור הבעיה נמצא. מתכנת זוטר, בתהליך עדכון של סקריפט פשוט לניתוח נתונים, הכניס בטעות באג מתוחכם. הבאג גרם למערכת לקרוא לא נכון את הדוחות הכספיים של מספר קטן של חברות, מה שהוביל לקסקדה של שגיאות שבסופו של דבר גרמה לפורטפוליו לקחת על עצמו הימור שוק גדול, לא מכוון והרסני. רוח הרפאים במכונה לא הייתה פגם בתזה ההשקעתית; היא הייתה פגם בתהליך היישום.

סיפור זה הוא משל אזהרה נפוץ מדי בעולם הפיננסים הכמותיים. אסטרטגיה מבריקה חסרת ערך אם היא לא מיושמת עם תשומת לב אובססיבית, כמעט פרנואידית, לפרטים. פרק זה עוסק בהנדסה המעשית, בעולם האמיתי, של תהליך השקעה חזק, ניתן לשחזור ואוטומטי. הוא עוסק בבניית "מפעל quant" שיכול לרוץ, יום אחר יום, ללא רוחות רפאים במכונה.

## מפעל ה-Quant: ממחקר לייצור

יש הבדל מהותי ומכריע בין עולם ה**מחקר (research)** לעולם ה**ייצור (production)**.
*   **סביבת המחקר** היא עולם של יצירתיות, של גמישות, של ניסוי וטעייה. זהו עולם של מחברות Jupyter, של סקריפטים אד-הוק, של מודלים ופרמטרים המשתנים ללא הרף. מטרת סביבת המחקר היא לגלות מקורות אלפא חדשים.
*   **סביבת הייצור** היא עולם של חוסן, של אמינות, של שחזוריות. זהו עולם של סקריפטים אוטומטיים, של בדיקות קפדניות, של קוד בלתי משתנה ומנוהל-גרסאות. מטרת סביבת הייצור היא לבצע בנאמנות וללא הרף את האסטרטגיה שפותחה בסביבת המחקר.

תהליך העברת אסטרטגיה ממחקר לייצור הוא אחד החלקים המאתגרים והחשובים ביותר בתהליך ההשקעה הכמותית. פרק זה מספק תוכנית אב לתהליך זה.

### זרימת העבודה מקצה לקצה: תוכנית אב מפורטת

תהליך השקעה כמותי מקצועי בתדירות נמוכה ניתן לחלוקה לשישה שלבים מרכזיים, המבוצעים בדרך כלל בקצב חודשי או רבעוני:
1.  **קליטת ואחסון נתונים (Data Ingestion and Warehousing):** היסוד של התהליך כולו. זה כולל הורדת כל הנתונים הדרושים ממקורות שונים (ספקי נתונים, אתרי אינטרנט ציבוריים וכו') ואחסונם במאגר נתונים מובנה היטב ו-point-in-time.
2.  **יצירת ועיבוד סיגנלים (Signal Generation and Processing):** כאן אנו לוקחים את הנתונים הגולמיים והופכים אותם לסיגנלים שיניעו את החלטות ההשקעה שלנו.
3.  **בניית ואופטימיזציית פורטפוליו (Portfolio Construction and Optimization):** כאן אנו משתמשים בסיגנלים שלנו כדי לבנות את פורטפוליו המטרה, תוך התחשבות בשיטת השקלול, האילוצים וכללי הנטרול הרצויים לנו.
4.  **ניתוח לפני-מסחר וניהול סיכונים (Pre-Trade Analysis and Risk Management):** לפני שאנו סוחרים, עלינו לנתח את הסיכון של פורטפוליו המטרה שלנו ולוודא שהוא נמצא בגבולות הרצויים לנו.
5.  **ביצוע עסקאות וניהול פקודות (Trade Execution and Order Management):** זהו תהליך שליחת הפקודות שלנו לברוקר והבטחה שהן מבוצעות ביעילות ובעלות נמוכה.
6.  **ניתוח לאחר-מסחר וייחוס ביצועים (Post-Trade Analysis and Performance Attribution):** לאחר ביצוע העסקאות, עלינו לנתח את הביצועים שלנו כדי להבין מאיפה הגיעו התשואות שלנו ולזהות בעיות פוטנציאליות בתהליך שלנו.

## סלע היסוד של היישום: ארבעת עמודי התווך של החוסן

תהליך ייצור חזק בנוי על ארבעה עמודי תווך מרכזיים:

### 1. שחזוריות (Reproducibility): אבן הפינה של תהליך מדעי

ניסוי מדעי אינו נחשב תקף אלא אם כן הוא ניתן לשחזור. כך גם לגבי אסטרטגיית השקעה כמותית. עליכם להיות מסוגלים לשחזר בדיוק את אותו פורטפוליו, מאותן תשומות בדיוק, בכל נקודת זמן בעתיד. זה דורש:
*   **ניהול גרסאות (Git):** כל פיסת קוד וכל קובץ תצורה במערכת שלכם צריכים להיות תחת שליטה של מערכת ניהול גרסאות כמו **Git**. זה מאפשר לכם לעקוב אחר כל שינוי שנעשה, לחזור לגרסה קודמת אם מתגלה באג, ולקבל נתיב ביקורת מלא של התפתחות האסטרטגיה שלכם.
*   **ניהול סביבה (Docker):** סביבת המחקר שלכם (המחשב הנייד שלכם) צפויה להיות שונה מסביבת הייצור שלכם (שרת ענן). מערכות הפעלה שונות, גרסאות שונות של Python, וגרסאות שונות של ספריות מפתח יכולות כולן להוביל לבאגים מתוחכמים וקשים לאבחון. **Docker** הוא כלי רב עוצמה המאפשר לכם ליצור סביבת מחשוב עקבית וניתנת לשחזור על ידי אריזת הקוד שלכם וכל התלותויות שלו לתוך "container" יחיד ועצמאי.
*   **זריעה דטרמיניסטית (Deterministic Seeding):** כל חלק בתהליך שלכם הכרוך באקראיות (למשל, מודל למידת מכונה, סימולציית מונטה קרלו) חייב להיות מאותחל עם **זרע דטרמיניסטי**. זהו מספר המשמש לאתחול מחולל המספרים האקראיים. על ידי הגדרת אותו זרע בכל פעם, אתם מבטיחים שתקבלו בדיוק את אותו רצף של מספרים אקראיים, ובכך בדיוק את אותן תוצאות.

### 2. ניהול תצורה: הפרדת קוד מפרמטרים

טעות נפוצה של מתכנתים חובבים היא **לקודד (hard-code)** את הפרמטרים של המודל שלהם ישירות בקוד. זהו חטא קטלני של הנדסת תוכנה. כל הפרמטרים של האסטרטגיה שלכם - חלונות מבט לאחור, יעדי סיכון, הנחות עלויות עסקה, נתיבי קבצים וכו' - צריכים להיות מאוחסנים ב**קובץ תצורה (configuration file)** נפרד (למשל, קובץ YAML או JSON). זה הופך את הקוד שלכם לגמיש יותר, קריא יותר, והרבה יותר קל לתחזוקה.

### 3. אוטומציה: חיסול הטעות האנושית

כל שלב ידני בתהליך שלכם הוא מקור פוטנציאלי לשגיאה. מטרתו של תהליך יישום מקצועי היא להפוך כמה שיותר לאוטומטי, ליצור מפעל "ללא אורות" שיכול לרוץ ללא כל התערבות אנושית. ניתן להשיג זאת באמצעות כלי תזמון כמו **cron** (בלינוקס) או מתזמן המשימות (בחלונות), שניתן להשתמש בהם כדי להריץ באופן אוטומטי את הסקריפטים שלכם בזמן שצוין.

### 4. ניטור והתראה: השומר הערני

אפילו במערכת אוטומטית לחלוטין, דברים יכולים להשתבש. הזנת נתונים יכולה להתעכב, אתר אינטרנט יכול לשנות את הפורמט שלו, ה-API של ברוקר יכול לקרוס. אתם זקוקים למערכת שתנטר את בריאות התהליך שלכם ותתריע בפניכם אם משהו משתבש. זה כולל:
*   **רישום (Logging):** הקוד שלכם צריך לייצר יומנים מפורטים של כל שלב שהוא מבצע, כל החלטה שהוא מקבל, וכל שגיאה שהוא נתקל בה.
*   **התראה (Alerting):** צריכה להיות לכם מערכת אוטומטית שמנתחת את היומנים הללו ושולחת לכם התראה (למשל, אימייל או הודעת טקסט) אם היא מזהה בעיה.

## ה-Runbook: המדריך המפורט שלכם לאפוקליפסה

**Runbook** הוא מדריך מפורט, צעד אחר צעד, לכל תהליך ההשקעה שלכם. הוא צריך להיות כל כך ברור ומפורש שאדם אחר, ללא ידע קודם במערכת שלכם, יוכל לעקוב אחריו ולבצע את האסטרטגיה שלכם. אבל runbook טוב הוא יותר מסתם רשימת תיוג; הוא גם מדריך למה לעשות כאשר דברים משתבשים. הוא צריך לכלול **ספר משחק למצבי-כשל (failure-mode playbook)** עבור כל הבעיות הנפוצות (והלא נפוצות) שאתם עלולים להיתקל בהן.

**דוגמה לספר משחק למצב-כשל:**
*   **בעיה:** הזנת נתונים מרכזית מתעכבת.
*   **פעולה:**
    1.  מערכת הניטור שולחת התראה.
    2.  אל תריץ את תהליך יצירת הסיגנלים עם נתונים מיושנים.
    3.  צור קשר עם ספק הנתונים כדי לקבל הערכה מתי הנתונים יהיו זמינים.
    4.  אם העיכוב קצר, המתן לנתונים. אם העיכוב ארוך, קבל החלטה המבוססת על כלל שהוגדר מראש (למשל, דלג על האיזון מחדש לתקופה זו והעבר את הפורטפוליו של התקופה הקודמת).
    5.  תעד את האירוע ביומן התפעול.

## ייחוס ביצועים: פירוק הרווח וההפסד שלכם

לאחר כל תקופת איזון מחדש, חיוני לנתח את ביצועי הפורטפוליו שלכם כדי להבין מאיפה הגיעו התשואות שלכם. זהו תהליך **ייחוס הביצועים (performance attribution)**.

**מודל ברינסון-פכלר:**
גישה קלאסית לייחוס היא מודל ברינסון-פכלר, המפרק את התשואה העודפת של הפורטפוליו על פני benchmark לשלושה מרכיבים:
1.  **הקצאת נכסים (Asset Allocation):** התשואה מההימורים שלכם על סוגי נכסים או סקטורים שונים.
2.  **בחירת מניות (Stock Selection):** התשואה מהיכולת שלכם לבחור מניות מנצחות בתוך כל סוג נכס או סקטור.
3.  **אינטראקציה:** מונח מכפלה צולבת קטן.

**ייחוס מבוסס-פקטורים:**
גישה מודרנית ורלוונטית יותר לאסטרטגיה כמותית היא **ייחוס מבוסס-פקטורים**. כאן, אנו מריצים רגרסיה של התשואות היומיות של הפורטפוליו על סט של גורמי סיכון ידועים (למשל, פקטורי פאמה-פרנץ'). משוואת הרגרסיה היא:

*R<sub>p,t</sub> - R<sub>f,t</sub> = α + β<sub>mkt</sub>(R<sub>m,t</sub> - R<sub>f,t</sub>) + β<sub>smb</sub>SMB<sub>t</sub> + β<sub>hml</sub>HML<sub>t</sub> + ... + ε<sub>t</sub>*

מקדמי רגרסיה זו אומרים לנו את רגישות הפורטפוליו לכל פקטור. ה**תרומה** של כל פקטור לתשואה הכוללת של הפורטפוליו היא פשוט תשואת הפקטור כפול הבטא של הפורטפוליו לאותו פקטור. ה-**alpha** מהרגרסיה היא החלק מהתשואה שאינו מוסבר על ידי אף אחד מהפקטורים הידועים. זוהי האלפא האמיתית והאידיוסינקרטית שלנו.

## מסקנה: ה-Quant כמהנדס

הכישורים הנדרשים כדי להיות משקיע כמותי מצליח אינם רק כישוריו של מדען או סטטיסטיקאי. הם גם כישוריו של מהנדס. ה-quant המצליח חייב להיות מסוגל לבנות מפעל חזק, אמין וניתן להרחבה לייצור אלפא. הוא חייב להיות אובססיבי לגבי פרטי היישום, לגבי צנרת המערכת, לגבי העבודה הלא-זוהרת אך החיונית של בניית תהליך עמיד בפני כישלון.

רעיון השקעה מבריק הוא תנאי הכרחי, אך לא מספיק, להצלחה. העולם זרוע ברוחות רפאים של רעיונות מבריקים שנהרסו על ידי יישום מרושל. השורדים לטווח ארוך במשחק ההשקעות הכמותיות אינם בהכרח אלה עם ה-IQ הגבוה ביותר; הם אלה עם תרבות ההנדסה החזקה והממושמעת ביותר.